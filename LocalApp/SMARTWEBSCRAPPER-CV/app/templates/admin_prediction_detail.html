{% extends "base.html" %}

{% block title %}D√©tail Pr√©diction - {{ item_id }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <h2>üîç D√©tail Pr√©diction Valid√©e</h2>
                <span class="badge bg-primary fs-6">Mod√®le IA ‚Üí Utilisateur ‚úÖ</span>
            </div>
            <p class="text-muted">
                <strong>ID:</strong> {{ item_id }} | 
                <strong>Source:</strong> Pr√©diction automatique valid√©e par l'utilisateur
            </p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="row mb-3">
        <div class="col">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('admin_dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('admin_predictions_validees') }}">Pr√©dictions Valid√©es</a></li>
                    <li class="breadcrumb-item active">{{ item_id }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <!-- Image et informations -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5>üñºÔ∏è Image Annot√©e</h5>
                </div>
                <div class="card-body text-center">
                    {% if annotated_image_url %}
                        <img src="{{ annotated_image_url }}" alt="Image annot√©e" class="img-fluid border rounded shadow-sm" style="max-height: 70vh;">
                        <p class="text-muted mt-2">
                            <small>üìç Image avec annotations OpenCV (bo√Ætes dessin√©es)</small>
                        </p>
                    {% else %}
                        <img src="{{ image_url }}" alt="Image originale" class="img-fluid border rounded shadow-sm" style="max-height: 70vh;">
                        <div class="alert alert-warning mt-3">
                            <strong>‚ö†Ô∏è Note:</strong> Image annot√©e non trouv√©e, affichage de l'image originale.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Actions et informations -->
        <div class="col-lg-4">
            <!-- Informations JSON -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5>üìä Informations</h5>
                </div>
                <div class="card-body">
                    {% if json_info.error %}
                        <div class="alert alert-danger">
                            <strong>‚ùå Erreur:</strong> {{ json_info.error }}
                        </div>
                    {% else %}
                        <ul class="list-unstyled">
                            <li><strong>üìù Annotations:</strong> {{ json_info.nb_annotations or 0 }}</li>
                            <li><strong>üè∑Ô∏è Cat√©gories:</strong> {{ json_info.categories or 0 }}</li>
                            {% if json_info.image_info %}
                                <li><strong>üìê Dimensions:</strong> {{ json_info.image_info.width }}√ó{{ json_info.image_info.height }}</li>
                            {% endif %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            <!-- Actions principales -->
            <div class="card">
                <div class="card-header">
                    <h5>‚ö° Actions</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted small mb-3">
                        Choisissez une action pour cette pr√©diction valid√©e :
                    </p>

                    <!-- ‚úÖ VALIDER -->
                    <form method="POST" action="{{ url_for('admin_action_prediction', item_id=item_id, action='validate') }}" class="mb-3">
                        <button type="submit" class="btn btn-success w-100 mb-2" 
                                onclick="return confirm('‚úÖ Valider cette pr√©diction ?\n\nüìÅ Actions :\n‚Ä¢ D√©placer vers fine_tune_data/\n‚Ä¢ Supprimer de human_data/model/\n‚Ä¢ Supprimer l\'image annot√©e OpenCV\n‚Ä¢ Garder le lien dans visited_links.json\n\nContinuer ?')">
                            <i class="fas fa-check-circle"></i> ‚úÖ Valider
                        </button>
                        <small class="text-muted">
                            D√©place vers fine_tune_data/ et supprime tous les fichiers sauf le lien d'origine
                        </small>
                    </form>

                    <hr>

                    <!-- ‚úèÔ∏è MODIFIER -->
                    <form method="POST" action="{{ url_for('admin_action_prediction', item_id=item_id, action='modify') }}" class="mb-3">
                        <button type="submit" class="btn btn-warning w-100 mb-2">
                            <i class="fas fa-edit"></i> ‚úèÔ∏è Modifier l'annotation
                        </button>
                        <small class="text-muted">
                            Ouvre l'interface d'annotation manuelle admin
                        </small>
                    </form>

                    <hr>

                    <!-- üóëÔ∏è SUPPRIMER -->
                    <form method="POST" action="{{ url_for('admin_action_prediction', item_id=item_id, action='delete') }}">
                        <button type="submit" class="btn btn-danger w-100 mb-2" 
                                onclick="return confirm('üóëÔ∏è SUPPRIMER D√âFINITIVEMENT cette pr√©diction ?\n\n‚ö†Ô∏è ATTENTION - Cette action va :\n‚Ä¢ Supprimer l\'image et JSON de human_data/model/\n‚Ä¢ Supprimer TOUS les fichiers li√©s dans TOUS les dossiers\n‚Ä¢ Garder seulement le lien dans visited_links.json\n\n‚ùå CETTE ACTION EST IRR√âVERSIBLE !\n\nContinuer ?')">
                            <i class="fas fa-trash"></i> üóëÔ∏è Supprimer
                        </button>
                        <small class="text-danger">
                            ‚ö†Ô∏è Suppression d√©finitive de tous les fichiers li√©s
                        </small>
                    </form>

                    <hr>

                    <!-- Retour -->
                    <a href="{{ url_for('admin_predictions_validees') }}" class="btn btn-outline-primary w-100">
                        <i class="fas fa-arrow-left"></i> ‚Ü©Ô∏è Retour √† la liste
                    </a>
                </div>
            </div>

            <!-- Aide -->
            <div class="card mt-3 border-info">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">üí° Aide</h6>
                </div>
                <div class="card-body">
                    <small>
                        <strong>üîÑ Workflow :</strong><br>
                        1. <strong>Valider</strong> = Pr√™t pour fine-tuning<br>
                        2. <strong>Modifier</strong> = Corriger les annotations<br>
                        3. <strong>Supprimer</strong> = √âliminer compl√®tement<br><br>
                        
                        <strong>üìÅ Apr√®s validation :</strong><br>
                        ‚Ä¢ Fichiers ‚Üí <code>fine_tune_data/</code><br>
                        ‚Ä¢ Historique ‚Üí <code>visited_links.json</code><br>
                        ‚Ä¢ Autres dossiers ‚Üí <span class="text-danger">Vid√©s</span>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Styles personnalis√©s -->
<style>
.btn {
    border-radius: 8px;
    font-weight: 500;
}

.btn-success {
    background: linear-gradient(45deg, #28a745, #20c997);
    border: none;
    box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
}

.btn-warning {
    background: linear-gradient(45deg, #ffc107, #fd7e14);
    border: none;
    color: #212529;
    box-shadow: 0 2px 4px rgba(255, 193, 7, 0.3);
}

.btn-danger {
    background: linear-gradient(45deg, #dc3545, #e83e8c);
    border: none;
    box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
}

.card {
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.badge {
    padding: 8px 16px;
    border-radius: 20px;
}

.alert {
    border-radius: 8px;
}
</style>
{% endblock %}